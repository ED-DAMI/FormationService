<div class="card mt-2 mb-2 section-card">
  <div class="card-header d-flex justify-content-between align-items-center">
    Section {{ sectionIndex + 1 }}:
    <button type="button" class="btn btn-sm btn-danger" (click)="onRemoveSection()">
      <i class="bi bi-trash"></i> Supprimer la Section
    </button>
  </div>
  <div class="card-body">
    <div class="form-group mb-3">
      <label for="sectionTitre{{chapitreIndex}}{{sectionIndex}}">Titre de la section :</label>
      <input type="text" id="sectionTitre{{chapitreIndex}}{{sectionIndex}}" class="form-control" [(ngModel)]="currentSection().titre" name="sectionTitre{{chapitreIndex}}{{sectionIndex}}">
    </div>

    <div class="form-group mb-3">
      <label for="typeContenu{{chapitreIndex}}{{sectionIndex}}">Type de Contenu :</label>
      <select id="typeContenu{{chapitreIndex}}{{sectionIndex}}" class="form-control" [(ngModel)]="currentSection().typeContenu" name="typeContenu{{chapitreIndex}}{{sectionIndex}}" (change)="onTypeContenuChange()">
        @for (type of typeContenuOptions; track type) {
          <option [value]="type">{{ type }}</option>
        }
      </select>
    </div>

    <!-- Contenu TEXTE -->
    @if (currentSection().typeContenu === 'TEXTE') {
      <div class="form-group mb-3">
        <label for="contenuTexte{{chapitreIndex}}{{sectionIndex}}">Contenu Texte :</label>
        <textarea id="contenuTexte{{chapitreIndex}}{{sectionIndex}}" class="form-control" [(ngModel)]="currentSection().contenu" name="contenuTexte{{chapitreIndex}}{{sectionIndex}}" rows="4"></textarea>
      </div>
    }

    <!-- Contenu IMAGE ou VIDEO (avec upload) -->
    @if (currentSection().typeContenu === 'IMAGE' || currentSection().typeContenu === 'VIDEO') {
      <div class="form-group mb-3">
        <label for="fileUpload{{chapitreIndex}}{{sectionIndex}}">
          {{ currentSection().typeContenu === 'IMAGE' ? 'Fichier Image' : 'Fichier Vidéo' }} :
        </label>
        <input type="file" id="fileUpload{{chapitreIndex}}{{sectionIndex}}" class="form-control" (change)="onFileSelected($event)"
               [attr.accept]="currentSection().typeContenu === 'IMAGE' ? 'image/*' : 'video/*'">
        <small class="form-text text-muted">Uploadez un fichier {{ currentSection().typeContenu === 'IMAGE' ? 'image' : 'vidéo' }}.</small>

        @if (filePreview()) {
          <div class="file-preview mt-3">
            @if (currentSection().typeContenu === 'IMAGE') {
              <img [src]="filePreview()!" alt="Prévisualisation image" class="img-thumbnail" style="max-width: 200px; max-height: 200px;">
            } @else if (currentSection().typeContenu === 'VIDEO') {
              <video [src]="filePreview()!" controls class="img-thumbnail" style="max-width: 200px; max-height: 200px;"></video>
            }
          </div>
        }
      </div>
    }
  </div>
</div>

