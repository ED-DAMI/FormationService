<div class="container mt-4">
  <h2>Créer une Nouvelle Formation</h2>

  <form (ngSubmit)="onSubmitFormation()">
    <!-- Informations Générales de la Formation -->
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">
        Informations Générales
      </div>
      <div class="card-body">
        <div class="form-group mb-3">
          <label for="formationTitre">Titre de la formation :</label>
          <input type="text" id="formationTitre" class="form-control" [(ngModel)]="newFormation().titre" name="formationTitre" required>
        </div>

        <div class="form-group mb-3">
          <label for="formationDescription">Description :</label>
          <textarea id="formationDescription" class="form-control" [(ngModel)]="newFormation().description" name="formationDescription" rows="3"></textarea>
        </div>

        <div class="form-group mb-3">
          <label for="formationNiveau">Niveau :</label>
          <select id="formationNiveau" class="form-control" [(ngModel)]="newFormation().niveau" name="formationNiveau" required>
            @for (niveau of niveauxFormation; track niveau) {
              <option [value]="niveau">{{ niveau }}</option>
            }
          </select>
        </div>

        <div class="form-group mb-3">
          <label for="coverImageUpload">Image de couverture :</label>
          <input type="file" id="coverImageUpload" class="form-control" (change)="onCoverFileSelected($event)" accept="image/*">
          <small class="form-text text-muted">Uploadez une image pour la couverture de la formation.</small>

          @if (coverImagePreview()) {
            <div class="image-preview mt-3">
              <img [src]="coverImagePreview()!" alt="Prévisualisation de la couverture" class="img-thumbnail" style="max-width: 200px; max-height: 200px;">
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Gestion des Cours (Composants Enfants) -->
    <div class="card mb-4">
      <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
        Liste des Cours
        <button type="button" class="btn btn-sm btn-light" (click)="addCours()">
          <i class="bi bi-plus-circle"></i> Ajouter un Cours
        </button>
      </div>
      <div class="card-body">
        @for (cours of newFormation().cours; track i; let i = $index) {
          <app-course-form
            [cours]="newFormation().cours![i]"
            [coursIndex]=""
            [coursIndex]="i"
            (remove)="removeCours($event)"
            (addChapitre)="addChapitre($event)"
            (removeChapitre)="removeChapitre($event.coursIndex, $event.chapitreIndex)"
            (addSection)="addSection($event.coursIndex, $event.chapitreIndex)"
            (removeSection)="removeSection($event.coursIndex, $event.chapitreIndex, $event.sectionIndex)"
            (sectionFileUpload)="onSectionFileUpload($event)"
            ></app-course-form>
        }
      </div>
    </div>

    <button type="submit" class="btn btn-success btn-lg" [disabled]="isSubmittingFormation()">
      <i class="bi bi-save"></i> {{ isSubmittingFormation() ? 'Création en cours...' : 'Créer la Formation' }}
    </button>
  </form>

  @if (message()) {
    <div class="alert mt-3" [ngClass]="{'alert-success': message().includes('✅'), 'alert-danger': message().includes('❌')}">
      {{ message() }}
    </div>
  }
</div>
